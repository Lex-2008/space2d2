(()=>{var Te=Object.create;var ie=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,Pe=Object.prototype.hasOwnProperty;var Le=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var Ce=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ke(e))!Pe.call(t,a)&&a!==r&&ie(t,a,{get:()=>e[a],enumerable:!(n=Me(e,a))||n.enumerable});return t};var $e=(t,e,r)=>(r=t!=null?Te(De(t)):{},Ce(e||!t||!t.__esModule?ie(r,"default",{value:t,enumerable:!0}):r,t));function Oe(t,e){let r=Math.hypot(t,e);return[t/r,e/r]}function Be(t,e){return t[0]*e[0]+t[1]*e[1]}function Ee(t,e,r){let n=Oe(t.x-e.x,t.y-e.y),a=Be(n,[r.x-e.x,r.y-e.y]);return[e.x+n[0]*a,e.y+n[1]*a]}function K(t,e,r,n){let[a,o]=Ee(t,e,r);return a>=Math.min(t.x,e.x)&&a<=Math.max(t.x,e.x)&&o>=Math.min(t.y,e.y)&&o<=Math.max(t.y,e.y)&&Math.hypot(a-r.x,o-r.y)<n}function I(t,e,r){return(e.x-t.x)*(r.y-t.y)-(e.y-t.y)*(r.x-t.x)}function oe(t,e,r,n){return t>e&&([t,e]=[e,t]),r>n&&([r,n]=[n,r]),Math.max(t,r)<=Math.min(e,n)}function se(t,e,r,n){return oe(t.x,e.x,r.x,n.x)&&oe(t.y,e.y,r.y,n.y)&&I(t,e,r)*I(t,e,n)<=0&&I(r,n,t)*I(r,n,e)<=0}function Ge(t,e){var r=Math.cos(t/180*Math.PI),n=-Math.sin(t/180*Math.PI),a=1/Math.max(Math.abs(r),Math.abs(n));return e+=c,r=r*a*e/2+e/2-c/2,n=n*a*e/2+e/2-c/2,[r,n]}var f=class{target;x;y;#e;list;constructor(e,r,n){this.value=e,this.target=n,[this.x,this.y]=Ge(e,r.size)}static normalize(e){for(;e<=-180;)e+=360;for(;e>180;)e-=360;return e}get value(){return this.#e}set value(e){this.#e=f.normalize(e)}angleTo(e){return e instanceof f?this.angleTo(e.value):f.normalize(e-this.#e)}positiveAngleTo(e){let r=this.angleTo(e);return r<0?r+360:r}add(e){return f.normalize(this.#e+e)}},z=class{#e;owner;constructor(e){this.#e=[],this.owner=e}*[Symbol.iterator](){for(var e of this.#e)yield e}add(e){let r=this.#e.findIndex(n=>n.value>e.value);r<0&&(r=this.#e.length),this.#e.splice(r,0,e),e.list=this}indexOf(e){return e instanceof f?this.#e.indexOf(e):typeof e=="number"?(e=f.normalize(e),this.#e.findIndex(r=>r.value==e)):this.#e.findIndex(r=>r.target==e)}angleBetween(e,r){let n=e instanceof f?e:this.directionOf(e),a=r instanceof f?r:this.directionOf(r);if(n==null||a==null)throw new ReferenceError(`either ${e} or ${r} is not part of this list`);return n.angleTo(a)}get count(){return this.#e.length}directionOf(e){let r=this.indexOf(e);if(r<0)throw ReferenceError("${item} is not part of ${this} directions list");return this.#e[r]}link(e,r){let n=this.indexOf(e);n<0?this.add(new f(e,this.owner,r)):this.#e[n].target=r}next(e){let r=this.indexOf(e);if(r<0)throw ReferenceError("${item} is not part of ${this} directions list");return this.#e[r+1]||this.#e[0]}prev(e){let r=this.indexOf(e);if(r<0)throw ReferenceError("${item} is not part of ${this} directions list");return this.#e[r-1]||this.#e.at(-1)}left(e){return this.next(e)}right(e){return this.prev(e)}};function T(t,e){return t>e&&([t,e]=[e,t]),Math.floor(Math.random()*(e-t+1))+t}function le(t){return t[Math.floor(Math.random()*t.length)]}function H(t){return t.map(e=>({sort:Math.random(),value:e})).sort((e,r)=>e.sort-r.sort).map(e=>e.value)}function C(t){return[...Array(t).keys()]}var B=["water","iron","food","radioactives"],ue=function(){for(var t=["blue","yellow","green","red"],e=[[null,"water-mining","farming","burning"],["ice",null,"hunting","fire"],["fishy","bio-mining",null,"nuclear"],["frozen","hot mining","ice-farming",null]],r=[["ocean",null,"water","navy","blue"],["dry","water",null,"blue","white"],["mining",null,"iron","olive","yellow"],["populated","food",null,"green","lime"]],n=0;n<4;n++)for(var a=0;a<4;a++)n!=a&&r.push([e[n][a],B[n],B[a],t[n],t[a]]);return r}(),k=class{x;y;type;name;buys;sells;color_in;color_out;constructor(e,r,n){var a=ue[n];this.x=e,this.y=r,this.type=n,this.name=a[0],this.buys=a[1],this.sells=a[2],this.color_in=a[3],this.color_out=a[4]}save(){return[this.x,this.y,this.type]}};function Re(t,e,r){var n=r/2;return t<n+.6&&t>n-.6&&e<n+.6&&e>n-.6}function he(t){for(var e=H(C(ue.length)),r=0;r<100;r++){for(var n=!1,a=[],o=H(C(t)),l=H(C(t)),b=t/2,h=0;h<t;h++)Re(o[h]+.5,l[h]+.5,t)&&(n=!0),a.push([o[h]+.5,l[h]+.5,e[h]]);if(!n)return a}return console.error("should not be here"),[]}var je=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkGray","DarkGrey","DarkKhaki","DarkOrange","DarkOrchid","DarkSalmon","DarkSeaGreen","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FireBrick","FloralWhite","Fuchsia","Gainsboro","GhostWhite","Gold","Goldenrod","Gray","GreenYellow","Grey","Honeydew","HotPink","IndianRed","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightGrey","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Orange","OrangeRed","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Red","RosyBrown","RoyalBlue","Salmon","SandyBrown","Seashell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];function Ie(t,e){for(var r=C(e+2*w).map(l=>[]),n=(e-1)/2,a=Math.floor(n);a<=Math.ceil(n);a++)for(var o=Math.floor(n);o<=Math.ceil(n);o++)r[a+1*w][o+1*w]=t;return r}function ze(t){var e={null:{buys:0,sells:0}};B.forEach(n=>{e[n]={buys:0,sells:0}}),t.forEach(n=>{e[String(n.buys)].buys++,e[String(n.sells)].sells++});var r=0;return B.forEach(n=>{r+=Math.min(e[n].buys,e[n].sells)}),r}var M=class{color;size;visited;x;y;bright;name;neighbours;grid;planets;jobs;constructor(e){if(e||(e={c:le(je),s:T(5,9),n:!1,p:!1,v:!1}),this.color=e.c,this.size=e.s,this.visited=e.v,this.x=this.y=this.size/2,this.bright=!1,this.name=this.color,this.size%2==0&&(this.bright=!0,this.name="bright "+this.name),this.neighbours=new z(this),e.n)for(var r of e.n)this.neighbours.add(new f(r,this));this.grid=Ie(this,this.size),e.p||(e.p=he(this.size)),this.planets=e.p.map(a=>new k(...a));for(var n of this.planets)this.grid[Math.floor(n.x)+1*w][Math.floor(n.y)+1*w]=n;this.jobs=ze(this.planets)}link(e,r){r instanceof f?(r.target=e,e.neighbours.link(r.value+180,this)):(this.neighbours.link(r,e),e.neighbours.link(r+180,this))}save(){return{c:this.color,s:this.size,n:Array.from(this.neighbours).map(e=>e.value),p:this.planets.map(e=>e.save()),v:this.visited}}};var s;function fe(t){s=t}var F='{"v":1,"s":{"c":"Yellow","s":4,"n":[-134,-71,-18,34,110,177],"p":[[2.5,0.5,3],[1.5,3.5,0],[3.5,2.5,5]],"v":false},"n":[{"c":"LightGreen","s":5,"n":[-145,-80,-8,46,99,151],"p":[[4.5,2.5,2],[1.5,0.5,9],[3.5,3.5,7],[2.5,1.5,12],[0.5,4.5,11]],"v":0},{"c":"LightGray","s":5,"n":[-128,-77,-27,46,109,172],"p":[[2.5,4.5,1],[3.5,2.5,9],[1.5,1.5,10],[0.5,3.5,15],[4.5,0.5,0]],"v":false},{"c":"Peru","s":5,"n":[-134,-79,-52,-9,34,98,162],"p":[[1.5,2.5,9],[4.5,1.5,6],[2.5,4.5,2],[3.5,0.5,0],[0.5,3.5,12]],"v":false},{"c":"Bisque","s":5,"n":[-146,-82,-19,9,52,94,169],"p":[[3.5,1.5,4],[1.5,3.5,9],[2.5,4.5,14],[0.5,2.5,2],[4.5,0.5,10]],"v":false},{"c":"LightBlue","s":6,"n":[-137,-70,-11,41,92,156],"p":[[1.5,3.5,13],[4.5,5.5,4],[5.5,2.5,6],[3.5,0.5,15],[2.5,4.5,3],[0.5,1.5,0]],"v":false},{"c":"LightSeaGreen","s":5,"n":[-144,-81,-3,43,88,154],"p":[[4.5,2.5,13],[3.5,4.5,14],[1.5,0.5,7],[2.5,3.5,11],[0.5,1.5,3]],"v":1}],"f":{"x":-0.25,"y":1.882,"c":null},"st":{"p":0,"s":0,"jf":0,"js":0}}';function A(t,e,r){return t.neighbours.directionOf(e).angleTo(t.neighbours.directionOf(r))}function pe(t,e){var r=[];for(var n of t.neighbours)if(!n.target){var a=new M;t.link(a,n),r.push(a)}var o=t.neighbours.left(e).target;if(!o)throw ReferenceError(`${t} and ${e} have no common neighbour on the left`);var l=t.neighbours.left(o).target;if(!l)throw ReferenceError(`${t} has no neighbour to the left from common neighbour`);var b=o.neighbours.right(t);o.link(l,b);var h=o.neighbours.angleBetween(o.neighbours.right(l),l),p=T(100-h,Math.min(160-h,80));console.log(`setting new angle to ${p} to have triangle ${h} - ${p} - ${180-h-p}`),S=new f(l.neighbours.directionOf(o).add(p),l),l.neighbours.add(S);var o=t.neighbours.right(e).target;if(!o)throw ReferenceError(`${t} and ${e} have no common neighbour on the right`);var l=t.neighbours.right(o).target;if(!l)throw ReferenceError(`${t} has no neighbour to the right from common neighbour`);var b=o.neighbours.left(t);o.link(l,b);var h=o.neighbours.angleBetween(l,o.neighbours.left(l)),p=T(100-h,Math.min(160-h,80));console.log(`setting new angle to ${p} to have triangle ${h} - ${p} - ${180-h-p}`),S=new f(l.neighbours.directionOf(o).add(-p),l),l.neighbours.add(S);for(var d of r){var _=t.neighbours.directionOf(d),ne=t.neighbours.right(_),x=ne.target;if(!x)throw ReferenceError(`${t} has no neighbour to the right from ${d}`);if(!(r.indexOf(x)<0)){t.neighbours.left(x).target!=d&&console.error("e0",d,x),_.target!=d&&console.error("e1",_,d);var _e=_.add(Math.round(_.angleTo(ne)/2));console.log(`linking ${d.name} and ${x.name}`),d.link(x,_e-90);var h=T(20,80),G=T(100-h,Math.min(160-h,80));(180-h-G<20||180-h-G>80)&&console.error("e3",h,G);var S=new f(d.neighbours.directionOf(x).add(h),d);d.neighbours.add(S);var S=new f(x.neighbours.directionOf(d).add(-G),x);x.neighbours.add(S)}}for(var a of r){for(var O=a.neighbours.next(a.neighbours.next(t)),Se=a.neighbours.prev(a.neighbours.prev(t)),R=O.positiveAngleTo(Se),j=0,p=T(20,80);p<R-20;p+=T(20,80)){console.log(`got ${p} will be ${O.add(p)}`);var S=new f(O.add(p),a);a.neighbours.add(S),j=p}console.log(`loop done with ${R-j} gap`),R-j>80&&(p=T(j+20,R-20),console.log(`adding ${p} (will be ${O.add(p)}) to fill the gap`),S=new f(O.add(p),a),a.neighbours.add(S))}var xe=[t,t.neighbours.left(e).target,t.neighbours.right(e).target];for(var ae of e.neighbours)xe.indexOf(ae.target)<0&&(ae.target=void 0);t.neighbours.left(e).target.neighbours.left(e).target=void 0,t.neighbours.right(e).target.neighbours.right(e).target=void 0}var y;function W(){return{v:1,s:s.save(),n:Array.from(s.neighbours).map(t=>t.target.save()),f:{x:u.steps[0].x,y:u.steps[0].y,c:u.steps[0].cargo},st:y}}function me(t){if(t.v==1){s=new M(t.s);for(var e=[],r=0;r<t.n.length;r++){var n=new M(t.n[r]);e.push(n),s.link(n,t.s.n[r])}for(var a of e){var o=s.neighbours.right(a).target;a.neighbours.left(s).target=o,o.neighbours.right(s).target=a}u.init(t.f.x,t.f.y,t.f.c,document.getElementById("myFlightplan")),y=t.st}}function Q(){var t=!0;for(var e of s.neighbours){if(!e.target){console.error("player_star has no neighbour at",e.value),t=!1;continue}f.normalize(e.value+180)!=e.target.neighbours.directionOf(s).value&&(console.error("player_star and ... dont point to each other",e.target.name,f.normalize(e.value+180),e.target.neighbours.directionOf(s).value),t=!1),s.neighbours.left(e).target!=e.target.neighbours.right(s).target&&(console.error("left (as seen from player_star) and right from ... dont match",e.target.name),t=!1),s.neighbours.right(e).target!=e.target.neighbours.left(s).target&&(console.error("right (as seen from player_star) and left from ... dont match",e.target.name),t=!1);var r=e.target.neighbours.next(s),n=r.target;if(!n){console.error("player_star has no neighbour after",e.target.name),t=!1;continue}n.neighbours.directionOf(e.target).value!=f.normalize(r.value+180)&&(console.error("neighbours dont point to each other",e.target.name,n.name,n.neighbours.directionOf(e.target).value,f.normalize(r.value+180)),t=!1),A(e.target,e.target.neighbours.prev(n),n)+A(n,e.target,n.neighbours.next(e.target))<100&&(console.error("future common neighbour of two neighbours will have bad angle",e.target.name,n.name,180-A(e.target,e.target.neighbours.prev(n),n)-A(n,e.target,n.neighbours.next(e.target))),t=!1);var a=Array.from(e.target.neighbours).map(l=>l.angleTo(e.target.neighbours.next(l))).filter(l=>Math.abs(l)<20||Math.abs(l)>80);a.length&&(console.error("neighbour has bad angles",e.target.name,a),t=!1)}var a=Array.from(s.neighbours).map(o=>o.angleTo(s.neighbours.next(o))).filter(o=>Math.abs(o)<20||Math.abs(o)>80);return a.length&&(console.error("player_star has bad angles"),t=!1),t}var m;function N(t){m=t}var Z,$;function ge(t,e,r){$=t,e.onmousemove=ve,Z=r,e.onmouseleave=function(){Z.innerText="Hover an object on the map to see what it is"},e.onclick=He}function ce(t){if(t instanceof f){if(!t.target)return["Portal to unknown"+(v=="test"?" at"+t.value:"")];var e=["Portal to "+ce(t.target)+(v=="test"?" at"+t.value:"")];if(v=="flyi")return e;if(m==s)if(Math.abs(t.x-u.steps[0].x)<.001&&Math.abs(t.y-u.steps[0].y)<.001)e.push("(you are here)");else{var r=u.cantJumpTo(t.target,t);r?e.push("You can't travel there: "+r):e.push("You can travel there")}else t.target==s?e=e.concat(["(you are there)","Click to return"]):t.target.visited&&e.push("(you've been there before)");return t.target!=s&&e.push("Click to explore"),e}else if(t instanceof k){var e=[t.name+" planet"];if(t.buys&&e.push("Buys: "+t.buys),t.sells&&e.push("Sells: "+t.sells),m==s&&v!="flyi"){var r=u.cantTravelTo(t);u.lastStep.planet==t?e.push("Click to remove it from the flight plan"):r?e.push(`Can't travel there: ${r}`):e.push("Click to add it to the flight plan")}return e}else if(t instanceof M)return[t.name+" star"];return["Unknown object"]}function de(t,e,r){var n=Math.floor(t/g-c),a=Math.floor(e/g-c);if(n<0||n>=$.size||a<0||a>=$.size){var b=L/g;for(var o of $.neighbours){var h=Math.hypot(t/g-o.x-c,e/g-o.y-c);if(h<b)return o}}if($.grid[n]){var l=$.grid[n][a];if(l){var b=P,h=Math.hypot(r.offsetX-(l.x+1*w+c)*g,r.offsetY-(l.y+1*w+c)*g);if(h<b)return l}}}function ve(t){let e=de(t.offsetX,t.offsetY,t);Z.innerHTML=e?ce(e).join("<br>"):"Space void"}function He(t){if(v=="flyi")return;let e=de(t.offsetX,t.offsetY,t);e instanceof k&&m==s&&(u.steps.findIndex(r=>r.planet==e)==u.steps.length-1?(u.undo(),D(),u.element.parentElement.scrollTop=1e3):u.cantTravelTo(e)||(u.add(e),D(),u.element.parentElement.scrollTop=1e3)),e instanceof f&&e.target&&(m=e.target,D(),ve(t))}var ee=class{steps;element;init(e,r,n,a){this.element=a,this.steps=[{start:!0,planet:{x:e,y:r},x:e,y:r,buy:!1,sell:!1,cargo:n}]}add(e){if(!(this.steps.findIndex(a=>a.planet==e)>=0)){var n=this.lastStep.cargo;this.steps.push({start:!1,planet:e,x:e.x,y:e.y,buy:!1,sell:!1,cargo:n}),this.updateStep(this.steps.length-1)}}undo(){this.steps.length<=1||this.steps.pop()}canSell(e){let r=this.steps[e];return!!r.planet.buys&&this.steps[e-1].cargo==r.planet.buys}setSell(e,r,n){if(!(r&&!this.canSell(e))){var a=this.steps[e];a.sell=r,n||this.updateStep(e,!0,!0)}}canBuy(e){return!!this.steps[e].planet.sells&&(!this.steps[e-1].cargo||this.steps[e].sell)}setBuy(e,r,n){if(r&&!this.canBuy(e))return;let a=this.steps[e];a.buy=r,n||this.updateStep(e,!0)}updateStep(e,r,n){if(e>=this.steps.length)return;let a=this.steps[e];n?a.sell&&!this.canSell(e)&&(a.sell=!1,r=!0):a.sell!=this.canSell(e)&&(a.sell=this.canSell(e),r=!0),a.buy&&!this.canBuy(e)&&(a.buy=!1,r=!0);var o=a.buy?a.planet.sells:a.sell?"":this.steps[e-1].cargo;r=r||a.cargo!=o,a.cargo=o,r&&this.updateStep(e+1)}countJobs(){return this.steps.reduce((e,r)=>e+=+r.sell,0)}get lastStep(){let e=this.steps.at(-1);if(!e)throw new ReferenceError("flighplan should never be empty");return e}canPathTo(e){for(var r=1;r<this.steps.length-1;r++)if(se(this.steps[r-1].planet,this.steps[r].planet,this.lastStep.planet,e))return!1;return!0}pathToCollidesWith(e){if(K(this.lastStep.planet,e,s,.5))return"star";var r=P/g;for(var n of s.planets)if(n!=e&&n!=this.lastStep.planet&&K(this.lastStep.planet,e,n,r))return n.name+" planet";return!1}cantTravelTo(e){if(this.steps.findIndex(n=>n.planet==e)>=0)return"planet already in flight plan";if(v=="easy")return!1;if(!this.canPathTo(e))return"crosses existing path";var r=this.pathToCollidesWith(e);return r?"path crosses "+r:!1}cantJumpTo(e,r){if(e==s)return"you're currently at this star";if(e.visited)return"you've already been here";if(v=="easy")return!1;if(!this.canPathTo(r))return"path to portal crosses existing path";var n=this.pathToCollidesWith(r);return n?"path crosses "+n:!1}},u=new ee;function te(){var t=u.steps.map((r,n)=>{var a=[];return r.start?(r=r,a.push(`Arrived to <b>${s.name} star</b>`+(r.cargo?` with ${r.cargo}`:""))):(r=r,a.push(`<div><b>${n}: ${r.planet.name} planet</b>`),r.planet.buys&&a.push(`<label><input type="checkbox" ${r.sell?"checked":""} ${u.canSell(n)?"":"disabled"} onchange="flightplan.setSell(${n},this.checked);redrawFlightplan()"> Sell ${r.planet.buys}</label>`),r.planet.sells&&a.push(`<label><input type="checkbox" ${r.buy?"checked":""} ${u.canBuy(n)?"":"disabled"} onchange="flightplan.setBuy(${n},this.checked);redrawFlightplan()"> Buy ${r.planet.sells}</label>`),a.push("</div>"),r.cargo?a.push(`Travel with ${r.cargo}`):a.push("Travel empty")),a.join(" ")}).join(" ");if(u.element.innerHTML=t,i("fp_undo").style.display=u.steps.length<=1?"none":"",i("fp_hint").style.display=m==s?"":"none",i("fp_jobs_done").innerText=""+u.countJobs(),i("fp_jobs_total").innerText=""+s.jobs,i("fp_jump").style.display=m==s?"none":"",m!=s){var e=u.cantJumpTo(m,s.neighbours.directionOf(m));i("fp_jump_ok").style.display=e?"none":"",i("fp_jump_ok_star").innerText=m.name+" star",i("fp_jump_ok_jobs").innerText=""+m.jobs,i("fp_jump_no").style.display=e?"":"none",i("fp_jump_no_reason").innerText=e||""}}var P=0,g=0,L=0,w=0,c=.5;function Ae(t,e){let r=(e.x+1*w+c)*g,n=(e.y+1*w+c)*g;var a=t.createRadialGradient(r-1,n-1,2,r,n,P);a.addColorStop(0,e.color_in),a.addColorStop(1,e.color_out),t.fillStyle=a,t.beginPath(),t.arc(r,n,P,0,6),t.fill()}function Fe(t,e){var r=(e.x+c)*g,n=(e.y+c)*g;e.target==s&&qe(t,r,n,e.value),t.strokeStyle="purple",e.target&&(t.strokeStyle="violet"),t.lineWidth=3;var a=Math.PI*L,o=Math.round(a/3),l=a/o;t.setLineDash([l,l]),t.beginPath(),t.arc(r,n,L,0,7),t.stroke()}function We(t,e,r){t.strokeStyle="violet",t.fillStyle="purple",t.lineWidth=3,t.setLineDash([1,0]),t.beginPath(),t.arc(e,r,L,0,7),t.fill()}function qe(t,e,r,n){let a=L*1.73,o=function(_){return a*Math.cos((_+n)/180*Math.PI)+e},l=function(_){return-a*Math.sin((_+n)/180*Math.PI)+r},b=a*3.46,h=a*3;t.strokeStyle="purple",t.lineWidth=4,t.setLineDash([1,0]),t.beginPath();let p=150,d=120;t.moveTo(o(p),l(p)),t.lineTo(o(d),l(d)),t.lineTo(o(0),l(0)),t.lineTo(o(-d),l(-d)),t.lineTo(o(-p),l(-p)),t.stroke()}function ye(t,e){var r=t.canvas.width;g=r/(e.size+2*w+2*c),P=g/5,L=c*g/5;var n=r/2;if(e.bright){var a=t.createRadialGradient(n,n,0,n,n,g/2);a.addColorStop(0,"white"),a.addColorStop(.5,e.color),a.addColorStop(1,"black"),t.fillStyle=a,t.fillRect(0,0,r,r)}else{var a=t.createRadialGradient(n,n,10,n,n,g/2);a.addColorStop(0,e.color),a.addColorStop(1,"black"),t.fillStyle=a,t.fillRect(0,0,r,r)}if(e==s){t.beginPath();var o=(u.steps[0].x+c)*g,l=(u.steps[0].y+c)*g;t.moveTo(o,l);for(var b=1;b<u.steps.length;b++){var h=(u.steps[b].x+c)*g,p=(u.steps[b].y+c)*g;t.lineTo(h,p)}t.strokeStyle="purple",t.setLineDash([6,6]),t.lineWidth=3,t.stroke(),We(t,o,l)}for(var d of e.planets)Ae(t,d);for(var _ of e.neighbours)Fe(t,_)}function i(t){let e=document.getElementById(t);if(!e)throw ReferenceError(`element ${t} not found`);return e}var v,be=i("myCanvas"),Je=be.getContext("2d"),q,J,Y,re;location.hostname=="localhost"?J=1e3*60*10:J=1e3*60*60*10;function D(){ye(Je,m),ge(m,be,i("hints")),te(),i("mapTitle_player").style.display=m==s?"":"none",i("mapTitle_neighbour").style.display=m==s?"none":"",m!=s&&(i("mapTitle_neighbour_n").innerText=""+s.neighbours.indexOf(m)+1,i("mapTitle_neighbour_total").innerText=""+s.neighbours.count),i("stats_s").innerText=""+y.s,i("stats_p").innerText=""+y.p,i("stats_js").innerText=""+y.js,i("stats_jf").innerText=""+y.jf,i("stats_jf_s").innerText=""+Math.round(y.jf/y.s*100)/100,i("stats_jf_p").innerText=""+Math.round(y.jf/y.p*100),i("stats_jf_js").innerText=""+Math.round(y.jf/y.js*100)}window.onhashchange=async function(){if(document.querySelectorAll("dialog[open]").forEach(n=>n.close()),i("main").style.display="none",X(!1),i("profile").style.display="none",v=location.hash.slice(1),["test","easy","hard","real"].indexOf(v)==-1){history.replaceState(0,"",location.pathname),i("select_mode").showModal();return}if(v=="test")return E(JSON.parse(F));if(["easy","hard"].indexOf(v)>-1)return E(JSON.parse(localStorage["space2d2"+v]||F));let e=(await import("../pocketbase/pocketbase.es.mjs")).default;var r;location.hostname=="localhost"?r=new e("http://127.0.0.1:8090"):r=new e("/"),window.pb=r,U=async function(){if(console.log("real mode save_game"),q)r.collection("real").update(q,{data:W()});else{var n=await r.collection("real").create({user:r.authStore.model.id,data:W()});q=n.id}},r.collection("users").authRefresh({},{expand:"real(user)"}).then(we,()=>Ye(r))};function Ye(t){window.login=function(){return t.collection("users").authWithPassword(i("login_email").value,i("login_password").value,{},{expand:"real(user)"}).then(e=>{i("login").close(),we(e)},e=>{console.log(e),i("login_failure").style.display="",i("login_details").innerText=JSON.stringify(e.response,null,2)}),!1},window.register=function(){t.collection("users").create({email:i("register_email").value,emailVisibility:!0,password:i("register_password").value,passwordConfirm:i("register_password").value}).then(async e=>{i("login_email").value=i("register_email").value,i("login_password").value=i("register_password").value,i("register").close(),i("register_to_login").showModal()},e=>{console.log(e),i("register_failure").style.display="",i("register_details").innerText=JSON.stringify(e.response,null,2)})},i("login").showModal()}function we(t){let e=t.record.expand["real(user)"];if(i("profile").style.display="",i("profile_name").innerText=t.record.email,i("profile_id").innerText=t.record.id,!e||!e.data)return E(JSON.parse(F));if(q=e.id,Y=new Date(e.updated).getTime()+J,Y<=new Date().getTime())return E(e.data);v="flyi",E(e.data),X(!0),V(),re=setInterval(V,1e3)}function V(){let t=Y-new Date().getTime();i("flyi_time").innerText=""+new Date(t).toISOString().substring(11,19),!(t>=1e3)&&(v="real",clearInterval(re),X(!1))}function X(t){i("mapTitle_flying").style.display=t?"":"none",i("mapTitle_player").style.display=t?"none":"",i("fpTitle_normal").style.display=t?"none":"",i("fpTitle_flyi").style.display=t?"":"none",i("myFlightplan").style.display=t?"none":"",i("fp_hint").style.display=t?"none":"",i("fp_flyi").style.display=t?"":"none"}function E(t){i("main").style.display="flex",me(t),Q()||alert("universe error, check console"),N(s),D()}var U=function(){console.log("simple mode save_game"),localStorage["space2d2"+v]=JSON.stringify(W())};function Ve(){if(m!=s&&!m.visited){y.s++,y.p+=u.steps.length-1,y.jf+=u.countJobs(),y.js+=s.jobs,console.clear(),pe(m,s);var t=u.lastStep.cargo,e=m.neighbours.directionOf(s);if(u.init(e.x,e.y,t,i("myFlightplan")),s.visited=!0,fe(m),Q()||alert("universe error, check console"),D(),v!="real")return U();if(y.s==1)return i("real_nosave").showModal();U(),v="flyi",Y=new Date().getTime()+J,X(!0),V(),re=setInterval(V,1e3)}}window.onhashchange();window.jump=Ve;window.redraw=D;window.flightplan=u;window.redrawFlightplan=te;window.set_shown_star=N;window.get_shown_star=()=>m;window.player_star=s;window.get_player_star=()=>s;window.save_game=U;location.hostname=="localhost"&&new EventSource("/esbuild").addEventListener("change",()=>location.reload());})();
//# sourceMappingURL=script.js.map
